@page "/"
@using new_assistant.Core.Interfaces
@using Microsoft.AspNetCore.Authorization
@inject IUserRoleService UserRoleService
@inject NavigationManager Navigation
@inject IHttpContextAccessor HttpContextAccessor

<PageTitle>KeyCloak Assistant</PageTitle>

@{
    var isAuthenticated = HttpContextAccessor.HttpContext?.User?.Identity?.IsAuthenticated == true;
    
    if (!isAuthenticated)
    {
        // Если пользователь не авторизован, перенаправляем на авторизацию через Keycloak
        Navigation.NavigateTo("/api/auth/login", forceLoad: true);
        return;
    }
    
    // Редиректим пользователей на их главные страницы
    if (UserRoleService.IsAdmin())
    {
        Navigation.NavigateTo("/info", forceLoad: true);
        return;
    }
    else if (UserRoleService.IsUser())
    {
        Navigation.NavigateTo("/clients", forceLoad: true);
        return;
    }
    else
    {
        // Если роль не определена, показываем сообщение
        <div id="index-undefined-role-section" class="mb-8 animate-stagger">
            <div class="flex items-center justify-between">
                <div id="index-undefined-content">
                    <h1 id="index-undefined-title" class="text-4xl font-bold gradient-text mb-2">
                        Добро пожаловать!
                    </h1>
                    <p id="index-undefined-description" class="text-gray-400 text-lg">Ваша роль не определена. Обратитесь к администратору.</p>
                </div>
            </div>
        </div>
        return;
    }
}